!function(t){var o=t.module("softLoop",[]);o.controller("SoftLoopController",["$rootScope",function(t){function o(t,o){var e=t.indexOf(o);return e>=0&&t.splice(e,1),o}var e,n=[],r=!1;this.phase=!1,this.init=function(o){r||(r=!0,this.scopeDecorate(o),e=t.$watch(),o.$on("$destroy",function(){n.length=0,e()}))},this.loop=function(){var o=this;this.phase=!0,n.forEach(function(t){t.$$softLoopWatchers.enable()}),e(),t.$$postDigest(function(){n.forEach(function(t){t.$$softLoopWatchers.disable()}),o.phase=!1})},this.scopeDecorate=function(e){var r=this;return n.unshift(e),e.$softLoop=!0,e.$$softLoopWatchers=[],["enable","disable","free"].forEach(function(t){e.$$softLoopWatchers[t]=function(){this.forEach(function(o){o[t]()})}}),e.$on("$destroy",function(){e.$$softLoopWatchers.free(),e.$$softLoopWatchers.length=0,o(n,e)}),e.$newRegular=function(t){var o=e.$new(t);return o.$softLoop&&(o.$new=o.constructor.prototype.$new,o.$watch=o.constructor.prototype.$watch,o.$$softLoopWatchers.enable(),o.$$softLoopWatchers.free(),o.$$softLoopWatchers.length=0,o.$softLoop=!1),o},e.$softLoopDigest=function(){t.$$phase?r.phase||r.loop():e.$digest()},e.$apply=function(){return r.phase||r.loop(),this.constructor.prototype.$apply.apply(e,arguments)},e.$digest=function(){return r.phase||r.loop(),this.constructor.prototype.$digest.apply(e,arguments)},e.$new=function(t){var o;return o=this.constructor.prototype.$new.call(e,t),r.scopeDecorate(o)},e.$watch=function(t,n,r){var c,i,s,f;return f=this.constructor.prototype.$watch.call(e,t,n,r),c=e.$$watchers[0],s=!0,i={enable:function(){s||(e.$$watchers.unshift(c),s=!0)},disable:function(){s&&(o(e.$$watchers,c),s=!1)},destroy:function(){s=!1,o(e.$$softLoopWatchers,i),o(e.$$watchers,c),f&&f(),i&&i.free&&i.free()},free:function(){delete this.enable,delete this.disable,delete this.destroy,f=c=i=void 0}},e.$$postDigest(function(){i&&i.disable()}),e.$$softLoopWatchers.unshift(i),i.destroy},e}}]),o.directive("softLoop",["$controller",function(t){return{transclude:"element",priority:200,terminal:!0,restrict:"A",compile:function(o,e,n){return function(o,r){var c,i,s=!1;c=o.$new(),i=t("SoftLoopController"),i.init(c),o.$watch(e.softLoop,function(t,o){t===o||s||(s=!0,i.loop(),c.$$postDigest(function(){s=!1}))}),n(c,function(t){r.after(t)})}}}}]),o.directive("softLoopArea",["$controller",function(t){return{transclude:"element",priority:200,terminal:!0,restrict:"A",compile:function(o,e,n){return function(o,e){var r,c,i=!1;r=o.$new(),c=t("SoftLoopController"),c.init(r),r.$$postDigest(function(){i=!0}),o.$watch(function(){i&&!c.phase&&c.loop()}),n(r,function(t){e.after(t)})}}}}]),o.directive("softLoopExclude",[function(){return{transclude:"element",priority:500,terminal:!0,restrict:"A",compile:function(t,o,e){return function(t,o){var n;n=t.$softLoop?t.$newRegular():t.$new(),e(n,function(t){o.after(t)})}}}}])}(window.angular);